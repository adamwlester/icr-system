%%
% [StepRun] Speed Ratios Average: Rear=0.954096 Front=0.983272
vel = [ ...
2.50, ...
5.00, ...
7.50, ...
10.00, ...
12.50, ...
15.00, ...
17.50, ...
20.00, ...
22.50, ...
25.00, ...
27.50, ...
30.00, ...
32.50, ...
35.00, ...
37.50, ...
40.00, ...
42.50, ...
45.00, ...
47.50, ...
50.00, ...
52.50, ...
55.00, ...
57.50, ...
60.00, ...
62.50, ...
65.00, ...
67.50, ...
70.00, ...
72.50, ...
75.00, ...
77.50, ...
80.00, ...
82.50, ...
85.00, ...
87.50, ...
90.00, ...
];

r_vel = [ ...
2.629926, ...
5.221484, ...
7.829623, ...
10.433334, ...
13.038059, ...
15.645382, ...
18.246214, ...
20.860509, ...
23.475867, ...
26.092962, ...
28.716569, ...
31.339319, ...
33.975407, ...
36.605818, ...
39.226323, ...
41.875494, ...
44.498480, ...
47.123890, ...
49.743726, ...
52.379277, ...
55.008432, ...
57.632152, ...
60.260729, ...
62.859791, ...
65.510505, ...
68.163775, ...
70.756591, ...
73.363606, ...
76.006274, ...
78.627180, ...
81.248086, ...
83.900101, ...
86.465853, ...
89.081077, ...
91.680719, ...
94.310653, ...
];

f_vel = [ ...
2.539003, ...
5.068175, ...
7.591648, ...
10.107362, ...
12.613461, ...
15.115115, ...
17.603246, ...
20.086910, ...
22.561709, ...
25.034827, ...
27.525637, ...
30.002477, ...
32.484299, ...
34.958375, ...
37.439531, ...
39.924222, ...
42.428472, ...
44.908408, ...
47.424243, ...
49.937008, ...
52.418120, ...
54.922948, ...
57.444807, ...
59.954058, ...
62.498528, ...
64.998469, ...
67.544993, ...
70.055337, ...
72.572726, ...
75.117784, ...
77.591476, ...
80.188128, ...
82.721866, ...
85.214991, ...
87.808490, ...
90.275651, ...
];

r_ratio = [ ...
0.950597, ...
0.957582, ...
0.957901, ...
0.958466, ...
0.958732, ...
0.958749, ...
0.959103, ...
0.958749, ...
0.958431, ...
0.958113, ...
0.957635, ...
0.957264, ...
0.956574, ...
0.956132, ...
0.955991, ...
0.955213, ...
0.955089, ...
0.954930, ...
0.954894, ...
0.954576, ...
0.954399, ...
0.954328, ...
0.954187, ...
0.954505, ...
0.954045, ...
0.953586, ...
0.953975, ...
0.954152, ...
0.953869, ...
0.953869, ...
0.953869, ...
0.953515, ...
0.954134, ...
0.954187, ...
0.954399, ...
0.954293, ...
];

f_ratio = [ ...
0.984639, ...
0.986548, ...
0.987928, ...
0.989378, ...
0.991005, ...
0.992384, ...
0.994135, ...
0.995673, ...
0.997265, ...
0.998609, ...
0.999069, ...
0.999917, ...
1.000483, ...
1.001191, ...
1.001615, ...
1.001898, ...
1.001686, ...
1.002040, ...
1.001597, ...
1.001261, ...
1.001562, ...
1.001403, ...
1.000961, ...
1.000766, ...
1.000024, ...
1.000024, ...
0.999334, ...
0.999210, ...
0.998998, ...
0.998432, ...
0.998821, ...
0.997654, ...
0.997318, ...
0.997477, ...
0.996487, ...
0.996947, ...
];

% Plot ratios
figure;
plot(vel', [r_ratio',f_ratio'], '*--')
legend('Rear','Front')

% Do ls fit
b_r = regress(vel',[ones(length(vel),1) r_vel']);
b_f = regress(vel',[ones(length(vel),1) f_vel']);

% Do robust fit
b_r = robustfit(r_vel', vel');
b_f = robustfit(f_vel', vel');

% Do polyfit
p_r = polyfit(r_vel, vel, 3);
p_r_s = p_r(1).*r_vel.^3 + p_r(2).*r_vel.^2 + p_r(3).*r_vel.^1 + p_r(4);
p_f = polyfit(f_vel, vel, 3);
p_f_s = p_f(1).*f_vel.^3 + p_f(2).*f_vel.^2 + p_f(3).*f_vel.^1 + p_f(4);
fprintf('%0.15f,\r', p_r);
fprintf('%0.15f,\r', p_f);

% Plot velocities
figure;
plot(vel', vel', 'k');
hold on
plot(vel', [r_vel',f_vel'], '*-')
% Plot lin corrected vels
plot(vel', [b_r(1)+b_r(2)*vel',b_f(1)+b_f(2)*vel'], '*--')
% % Plot scaled corrected vels
% s_r = 0.952948; 
% s_f = 0.977682;
% plot(vel', [vel'*s_r,vel'*s_f], '*:');
% Plot ployfit corrected vals
plot(vel', [p_r_s', p_f_s'], '-.');
legend('Vel', 'Rear Raw','Front Raw','Rear Lin','Front Lin','Rear Poly','Front Poly');
axis square
grid on

%vel_raw = [r_vel', f_vel'];
%vel_lin = [r_vel', f_vel'];
%vel_scale = [r_vel', f_vel'];
% figure
% plot(vel', [vel_raw,vel_lin,vel_scale], '*-')
% legend('Rear_Raw','Front_Raw','Rear_Lin','Front_Lin','Rear_Scale','Front_Scale')
% axis square
% 
% figure
% plot(vel', [diff(vel_lin,1,2),diff(vel_scale,1,2)], '*-')
% legend('Diff_Lin','Diff_Scale')

%%
% % Baseline
% vel = [ ...
% 10.00, ...
% 20.00, ...
% 30.00, ...
% 40.00, ...
% 50.00, ...
% 60.00, ...
% 70.00, ...
% 80.00, ...
% ];
% 
% r_ratio = [ ...
% 0.959528, ...
% 0.959881, ...
% 0.958113, ...
% 0.955637, ...
% 0.954930, ...
% 0.953869, ...
% 0.953161, ...
% 0.953515, ...
% ];
% 
% f_ratio = [ ...
% 0.992950, ...
% 1.000554, ...
% 1.004268, ...
% 1.003737, ...
% 1.001792, ...
% 0.999493, ...
% 0.997725, ...
% 0.995956, ...
% ];

% % AD_F.setRunKVAL(50); 
% vel = [ ...
% 10.00, ...
% 20.00, ...
% 30.00, ...
% 40.00, ...
% 50.00, ...
% 60.00, ...
% 70.00, ...
% 80.00, ...
% ];
% 
% r_ratio = [ ...
% 0.957229, ...
% 0.957405, ...
% 0.956521, ...
% 0.954930, ...
% 0.954930, ...
% 0.953869, ...
% 0.953161, ...
% 0.952100, ...
% ];
% 
% f_ratio = [ ...
% 0.988706, ...
% 0.993127, ...
% 0.995249, ...
% 0.995956, ...
% 0.994718, ...
% 0.994188, ...
% 0.994011, ...
% 0.993127, ...
% ];

% % AD_F.setParam(STEP_MODE, STEP_FS_64);
% % AD_F.setRunKVAL(50); 
% vel = [ ...
% 10.00, ...
% 20.00, ...
% 30.00, ...
% 40.00, ...
% 50.00, ...
% 60.00, ...
% 70.00, ...
% 80.00, ...
% ];
% 
% r_ratio = [ ...
% 0.957052, ...
% 0.957052, ...
% 0.955991, ...
% 0.955637, ...
% 0.954045, ...
% 0.953869, ...
% 0.954399, ...
% 0.953515, ...
% ];
% 
% f_ratio = [ ...
% 0.987999, ...
% 0.992066, ...
% 0.994188, ...
% 0.995249, ...
% 0.993834, ...
% 0.993127, ...
% 0.992773, ...
% 0.991712, ...
% ];

% % AD_F.setParam(STEP_MODE, STEP_FS_32);
% % AD_F.setRunKVAL(50); 
% vel = [ ...
% 10.00, ...
% 20.00, ...
% 30.00, ...
% 40.00, ...
% 50.00, ...
% 60.00, ...
% 70.00, ...
% 80.00, ...
% ];
% 
% r_ratio = [ ...
% 0.957582, ...
% 0.957052, ...
% 0.956521, ...
% 0.955637, ...
% 0.954930, ...
% 0.953869, ...
% 0.954399, ...
% 0.954930, ...
% ];
% 
% f_ratio = [ ...
% 0.987999, ...
% 0.992066, ...
% 0.994188, ...
% 0.995249, ...
% 0.994718, ...
% 0.994188, ...
% 0.992773, ...
% 0.991712, ...
% ];

% % AD_F.setParam(STEP_MODE, STEP_FS_64);
% % AD_F.setRunKVAL(40); 
% vel = [ ...
% 10.00, ...
% 20.00, ...
% 30.00, ...
% 40.00, ...
% 50.00, ...
% 60.00, ...
% 70.00, ...
% 80.00, ...
% ];
% 
% r_ratio = [ ...
% 0.953869, ...
% 0.953869, ...
% 0.953338, ...
% 0.952808, ...
% 0.953161, ...
% 0.952808, ...
% 0.953161, ...
% 0.952100, ...
% ];
% 
% f_ratio = [ ...
% 0.980395, ...
% 0.981809, ...
% 0.982517, ...
% 0.983224, ...
% 0.983224, ...
% 0.983578, ...
% 0.984108, ...
% 0.984639, ...
% ];

% % AD_F.setParam(STEP_MODE, STEP_FS_64);
% % AD_F.setRunKVAL(30);
% % AD_R.setAccKVAL(40);
% vel = [ ...
% 10.00, ...
% 20.00, ...
% 30.00, ...
% 40.00, ...
% 50.00, ...
% 60.00, ...
% 70.00, ...
% 80.00, ...
% ];
% 
% r_ratio = [ ...
% 0.953633, ...
% 0.953515, ...
% 0.952808, ...
% 0.953043, ...
% 0.953161, ...
% 0.953515, ...
% 0.953161, ...
% 0.954458, ...
% ];
% 
% f_ratio = [ ...
% 0.977447, ...
% 0.978037, ...
% 0.978980, ...
% 0.978980, ...
% 0.979098, ...
% 0.979687, ...
% 0.980394, ...
% 0.979923, ...
% ];

% % AD_F.setParam(STEP_MODE, STEP_FS_64);
% % AD_F.setRunKVAL(30);
% % AD_R.setAccKVAL(40);
% % AD_R.setDecKVAL(40);
% vel = [ ...
% 10.00, ...
% 20.00, ...
% 30.00, ...
% 40.00, ...
% 50.00, ...
% 60.00, ...
% 70.00, ...
% 80.00, ...
% ];
% 
% r_ratio = [ ...
% 0.954222, ...
% 0.953751, ...
% 0.953515, ...
% 0.953515, ...
% 0.953161, ...
% 0.954222, ...
% 0.952336, ...
% 0.954458, ...
% ];
% 
% f_ratio = [ ...
% 0.977329, ...
% 0.978272, ...
% 0.978626, ...
% 0.978980, ...
% 0.979687, ...
% 0.978980, ...
% 0.979569, ...
% 0.978980, ...
% ];

% % AD_F.setParam(STEP_MODE, STEP_FS_64);
% % AD_F.setRunKVAL(20);
% % AD_R.setAccKVAL(40);
% % AD_R.setDecKVAL(40);
% vel = [ ...
% 10.00, ...
% 20.00, ...
% 30.00, ...
% 40.00, ...
% 50.00, ...
% 60.00, ...
% 70.00, ...
% 80.00, ...
% ];
% 
% r_ratio = [ ...
% 0.954105, ...
% 0.953987, ...
% 0.954222, ...
% 0.953515, ...
% 0.954340, ...
% 0.954222, ...
% 0.954812, ...
% 0.953515, ...
% ];
% 
% f_ratio = [ ...
% 0.975561, ...
% 0.975443, ...
% 0.976150, ...
% 0.976622, ...
% 0.976150, ...
% 0.976858, ...
% 0.977093, ...
% 0.977094, ...
% ];

% % AD_F.setParam(STEP_MODE, STEP_FS_64);
% % AD_F.setRunKVAL(20);
% % AD_R.setAccKVAL(40);
% % AD_R.setDecKVAL(40);
% % AD_F.setHoldKVAL(20);
% vel = [ ...
% 10.00, ...
% 20.00, ...
% 30.00, ...
% 40.00, ...
% 50.00, ...
% 60.00, ...
% 70.00, ...
% 80.00, ...
% ];
% 
% r_ratio = [ ...
% 0.954812, ...
% 0.954694, ...
% 0.954576, ...
% 0.954930, ...
% 0.954340, ...
% 0.954930, ...
% 0.955637, ...
% 0.951629, ...
% ];
% 
% f_ratio = [ ...
% 0.975207, ...
% 0.975443, ...
% 0.976150, ...
% 0.976150, ...
% 0.976150, ...
% 0.976858, ...
% 0.977093, ...
% 0.977094, ...
% ];